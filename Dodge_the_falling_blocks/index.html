<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smooth Player Dodge Game with Dash</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #222;
    font-family: sans-serif;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    user-select: none;
  }
  canvas {
    background: #111;
    border: 2px solid #fff;
    display: block;
  }
  #score {
    position: absolute;
    top: 10px;
    font-size: 20px;
  }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const player = {
  x: 180,
  y: 550,
  width: 40,
  height: 40,
  vx: 0,
  speed: 0.5,
  friction: 0.85,
  dashPower: 5,
  canDash: true
};

let obstacles = [];
let score = 0;
let gameOver = false;
let keys = { left: false, right: false, dash: false };
let lastTime = 0;

function createObstacle() {
  const width = Math.random() * 60 + 20;
  const x = Math.random() * (canvas.width - width);
  const speed = Math.random() * 2 + 2;
  obstacles.push({ x, y: -20, width, height: 20, speed });
}

function drawPlayer() {
  ctx.fillStyle = '#0f0';
  ctx.fillRect(player.x, player.y, player.width, player.height);
}

function drawObstacles() {
  ctx.fillStyle = '#f00';
  obstacles.forEach(obs => ctx.fillRect(obs.x, obs.y, obs.width, obs.height));
}

function updateObstacles(delta) {
  obstacles.forEach(obs => obs.y += obs.speed * delta);
  obstacles = obstacles.filter(obs => obs.y < canvas.height + obs.height);
}

function checkCollision() {
  for (let obs of obstacles) {
    if (player.x < obs.x + obs.width &&
        player.x + player.width > obs.x &&
        player.y < obs.y + obs.height &&
        player.y + player.height > obs.y) {
      gameOver = true;
    }
  }
}

function updateScore(delta) {
  score += delta * 0.1; // now a number
  document.getElementById('score').textContent = 'Score: ' + Math.floor(score);
}

function updatePlayer() {
  if (keys.left) player.vx -= player.speed;
  if (keys.right) player.vx += player.speed;

  // dash mechanic
  if (keys.dash && player.canDash) {
    player.vx += player.dashPower * (keys.left ? -1 : keys.right ? 1 : 0);
    player.canDash = false; // only once per key press
  }

  player.vx *= player.friction; // smooth deceleration
  player.x += player.vx;

  // constrain within canvas
  if (player.x < 0) { player.x = 0; player.vx = 0; }
  if (player.x > canvas.width - player.width) { player.x = canvas.width - player.width; player.vx = 0; }
}

function gameLoop(timestamp) {
  if (!lastTime) lastTime = timestamp;
  const delta = (timestamp - lastTime) / 16.666; // relative to 60fps
  lastTime = timestamp;

  if (gameOver) {
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = '#fff';
    ctx.font = '30px sans-serif';
    ctx.fillText('Game Over!', 110, 300);
    ctx.font = '20px sans-serif';
    ctx.fillText('Final Score: ' + Math.floor(score), 130, 340);
    return;
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (Math.random() < 0.02) createObstacle();

  updatePlayer();
  drawPlayer();
  drawObstacles();
  updateObstacles(delta);
  checkCollision();
  updateScore(delta);

  requestAnimationFrame(gameLoop);
}

document.addEventListener('keydown', e => {
  if (e.key === 'ArrowLeft') keys.left = true;
  if (e.key === 'ArrowRight') keys.right = true;
  if (e.key === 'Shift') keys.dash = true;
});

document.addEventListener('keyup', e => {
  if (e.key === 'ArrowLeft') keys.left = false;
  if (e.key === 'ArrowRight') keys.right = false;
  if (e.key === 'Shift') { 
    keys.dash = false;
    player.canDash = true; // reset dash on key release
  }
});

gameLoop();
</script>
</body>
</html>
