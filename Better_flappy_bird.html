<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Raph — Keyboard Controlled Flappy Bird</title>
  <style>
    :root{--bg:#70c5ce;--bird:#ffcc00;--pipe:#228B22;--ground:#de9b45}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(#80d7e0,#53c0d0);}
    .game-wrap{width:480px;max-width:92vw;background:linear-gradient(#aeeaf0,#9fe7ee);box-shadow:0 8px 30px rgba(0,0,0,0.18);border-radius:12px;overflow:hidden}
    header{padding:8px 12px;background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:space-between}
    header h1{font-size:14px;margin:0}
    #game{background:var(--bg);display:block;width:100%;height:640px}
    .overlay{position:absolute;left:0;right:0;text-align:center;padding:6px 10px;background:linear-gradient(transparent,rgba(0,0,0,0.08));color:#042;}
    .controls{font-size:13px;color:#044;margin-right:6px}
    .footer{display:flex;justify-content:space-between;padding:8px 12px;background:rgba(255,255,255,0.04);font-size:13px}
    button{border:0;background:#fff;padding:6px 10px;border-radius:6px;cursor:pointer}
    button:active{transform:translateY(1px)}
    .small{font-size:12px;color:#064}
    @media (max-width:520px){#game{height:540px}}
  </style>
</head>
<body>
  <div class="game-wrap">
    <header>
      <h1>Flappy Raph — press Space or ↑ to flap</h1>
      <div class="controls">Score: <span id="score">0</span></div>
    </header>

    <div style="position:relative">
      <canvas id="game"></canvas>
      <div class="overlay" id="message" style="display:none;position:absolute;top:40%;transform:translateY(-50%);pointer-events:none">
        <div style="background:rgba(255,255,255,0.92);display:inline-block;padding:14px 18px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.12)">
          <div id="msg-title" style="font-weight:700;font-size:18px;margin-bottom:6px">Paused</div>
          <div id="msg-body" style="margin-bottom:8px">Press Space or ↑ to start. R to restart anytime.</div>
          <div style="font-size:12px;color:#333">Keyboard: Space / Up to flap — R to restart</div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="small">Physics: gravity + velocity, simple AABB collision</div>
      <div>
        <button id="btn-start">Start / Resume</button>
        <button id="btn-reset">Reset</button>
      </div>
    </div>
  </div>

  <script>
  (function(){
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const msg = document.getElementById('message');
    const msgTitle = document.getElementById('msg-title');
    const msgBody = document.getElementById('msg-body');
    const btnStart = document.getElementById('btn-start');
    const btnReset = document.getElementById('btn-reset');

    function fitCanvas(){
      const styleW = Math.min(480, Math.floor(window.innerWidth*0.92));
      const styleH = Math.floor(styleW * (640/480));
      canvas.style.width = styleW + 'px';
      canvas.style.height = styleH + 'px';
      canvas.width = styleW;
      canvas.height = styleH;
    }
    window.addEventListener('resize', fitCanvas);
    fitCanvas();

    function GAME_W(){ return canvas.width; }
    function GAME_H(){ return canvas.height; }

    const groundHeight = 60;
    const gravity = 1200;
    const flapSpeed = -350;
    const pipeWidth = 60;
    const pipeGap = 150;
    const pipeSpacing = 230; // horizontal distance between pipes
    const pipeSpeed = 160;

    let bird = null;
    let pipes = [];
    let lastTime = 0;
    let score = 0;
    let running = false;
    let gameOver = false;

    function resetState(){
      bird = { x:80, y: GAME_H()/2, w:34, h:24, vy:0, rotation:0 };
      pipes = [];
      lastTime = performance.now();
      score = 0;
      running = false;
      gameOver = false;
      updateScore();
      showMessage('Press Space or ↑ to start','');
    }

    function rnd(min,max){return Math.random()*(max-min)+min}

    function spawnPipe(){
      const h = GAME_H() - groundHeight;
      const gapY = h/2 + rnd(-60,60);
      const pipe = { x: GAME_W(), gapY, width: pipeWidth, passed:false };
      pipes.push(pipe);
    }

    function rectsOverlap(a,b){
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    function update(dt){
      if(!running) return;
      bird.vy += gravity * dt;
      bird.y += bird.vy * dt;
      bird.rotation = Math.max(-0.6, Math.min(1.2, bird.vy / 600));

      // spawn new pipe when last pipe is far enough left
      if(pipes.length === 0 || (GAME_W() - (pipes[pipes.length-1].x + pipeWidth)) > pipeSpacing){
        spawnPipe();
      }

      for(let p of pipes){ p.x -= pipeSpeed * dt; }
      pipes = pipes.filter(p => p.x + p.width > 0);

      for(let p of pipes){
        if(!p.passed && p.x + p.width < bird.x){ p.passed = true; score++; updateScore(); }
        const topRect = { x: p.x, y: 0, w: p.width, h: p.gapY };
        const bottomRect = { x: p.x, y: p.gapY + pipeGap, w: p.width, h: GAME_H() - (p.gapY + pipeGap) - groundHeight };
        const birdRect = { x: bird.x - bird.w/2, y: bird.y - bird.h/2, w: bird.w, h: bird.h };
        if(rectsOverlap(birdRect, topRect) || rectsOverlap(birdRect, bottomRect)){
          running = false; gameOver = true; showMessage('Game Over', 'Press R to restart');
        }
      }

      if(bird.y + bird.h/2 > GAME_H() - groundHeight){
        bird.y = GAME_H() - groundHeight - bird.h/2;
        running = false; gameOver = true; showMessage('Game Over', 'You hit the ground — press R to try again');
      }
      if(bird.y - bird.h/2 < 0){ bird.y = bird.h/2; bird.vy = 0; }
    }

    function draw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      const g = ctx.createLinearGradient(0,0,0,GAME_H());
      g.addColorStop(0,'#9fe7ee'); g.addColorStop(1,'#7ddfe6');
      ctx.fillStyle = g; ctx.fillRect(0,0,GAME_W(),GAME_H());
      for(let p of pipes){
        ctx.fillStyle = '#2e8b57';
        ctx.fillRect(p.x, 0, p.width, p.gapY);
        ctx.fillRect(p.x, p.gapY + pipeGap, p.width, GAME_H() - (p.gapY + pipeGap) - groundHeight);
        ctx.fillStyle = '#196d3a'; ctx.fillRect(p.x-6, Math.max(0,p.gapY-10), p.width+12, 10);
      }
      ctx.fillStyle = '#d99c44'; ctx.fillRect(0, GAME_H()-groundHeight, GAME_W(), groundHeight);
      for(let i=0;i<GAME_W();i+=24){ ctx.fillStyle = 'rgba(0,0,0,0.03)'; ctx.fillRect(i, GAME_H()-groundHeight, 12, 6); }
      ctx.save();
      ctx.translate(bird.x, bird.y);
      ctx.rotate(bird.rotation);
      ctx.fillStyle = '#ffdd33'; ctx.beginPath(); ctx.ellipse(0,0,bird.w/2,bird.h/2,0,0,Math.PI*2); ctx.fill();
      ctx.fillStyle = '#ff8c00'; ctx.beginPath(); ctx.moveTo(bird.w/2-2,0); ctx.lineTo(bird.w/2+12,6); ctx.lineTo(bird.w/2+12,-6); ctx.closePath(); ctx.fill();
      ctx.fillStyle = '#222'; ctx.beginPath(); ctx.arc(4,-4,3,0,Math.PI*2); ctx.fill();
      const wingOffset = Math.max(-6, Math.min(12, -bird.vy/20));
      ctx.fillStyle = 'rgba(0,0,0,0.08)'; ctx.beginPath(); ctx.ellipse(-2, wingOffset, 10,6, Math.PI/6,0,Math.PI*2); ctx.fill();
      ctx.restore();
      ctx.fillStyle = 'rgba(255,255,255,0.9)'; ctx.font = '600 48px system-ui'; ctx.textAlign = 'center';
      ctx.fillText(score, GAME_W()/2, 80);
    }

    function gameLoop(now){
      const dt = Math.min(0.05, (now - lastTime)/1000);
      lastTime = now;
      update(dt);
      draw();
      requestAnimationFrame(gameLoop);
    }

    function flap(){
      if(gameOver) return;
      if(!running){ running = true; hideMessage(); }
      bird.vy = flapSpeed;
    }

    window.addEventListener('keydown', (e)=>{
      if(e.code === 'Space' || e.code === 'ArrowUp'){ e.preventDefault(); flap(); }
      if(e.key === 'r' || e.key === 'R') resetState();
      if(e.code === 'KeyP'){ running = !running; showMessage(running?'':'Paused', running?'':'Press Space to resume'); }
    });
    canvas.addEventListener('pointerdown', (e)=>{ flap(); });
    function updateScore(){ scoreEl.textContent = score; }
    function showMessage(title, body){ msgTitle.textContent = title||''; msgBody.textContent = body||''; msg.style.display='block'; }
    function hideMessage(){ msg.style.display='none'; }
    btnStart.addEventListener('click', ()=>{ if(gameOver) return; running=true; hideMessage(); });
    btnReset.addEventListener('click', resetState);
    resetState();
    requestAnimationFrame((t)=>{ lastTime = t; requestAnimationFrame(gameLoop); });
  })();
  </script>
</body>
</html>
